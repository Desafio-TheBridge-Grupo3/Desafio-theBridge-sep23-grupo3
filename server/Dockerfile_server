FROM contenedoresdesafiotripulacionesg3.azurecr.io/alpinesecuredesafio:latest

ENV APP_PORT=5173 \
    SQL_HOST="database-desafio-grupo3.postgres.database.azure.com" \
    SQL_USER="grupo3desafio" \
    SQL_DATABASE="proyectoTribu"

WORKDIR /app/server

COPY . .

RUN npm install

EXPOSE $APP_PORT

CMD ["sh", "-c", "psql --host=$(SQL_HOST) --port=5432 --username=$(SQL_USER) --dbname=$(SQL_DATABASE) --set=sslmode=require --set=sslrootcert=DigiCertGlobalRootCA.crt.pem && \
                  cd .. && npm start"]
